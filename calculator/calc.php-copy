<?
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_before.php");
header('Content-type: text/html; charset=cp1251');
?>

<?
// Çàãğóçêà ìîäóëåé Áèòğèêñà
if (!Bitrix\Main\Loader::includeModule('iblock') or !Bitrix\Main\Loader::includeModule('catalog'))
{
    die ('Îøèáêà â çàãğóçêè ìîäóëåé...');
}

//p($_POST,'_POST');

$arPost = array();
foreach($_POST as $key => $value){
    if(is_array($value)){
        foreach($value as $val){ 
            $arPost[$key][] = iconv('utf-8', 'cp1251', $val);
        }
    }
    else
        $arPost[$key] = iconv('utf-8', 'cp1251', $_POST[$key]);
}

p($arPost,'arPost');
// p(serialize($arPost),'serialize');

//p(mb_convert_encoding($arPost['type_install_stolba'],'cp1251'), 'type_install_stolba');

$arType = array( //Òèï ïàíåëè:  fit, light, optima, medium2d, Estetic, power, industrial
        'F' => 'Fit',
        'L' => 'Light',
        'Î' => 'Optima',
        'P' => 'Power',
        'I' => 'Industrial',
        'Ì' => 'Medium 2D',
        'Å' => 'Estetic',
        //'H' => 'H',
        
    );
$kolKrepegForHeightOgr = array( // Ê – ñîîòâåòñòâèå êîë-âà êğåïåæåé âûñîòå îãğàæäåíèÿ, ñì. ñë. 24-26
    '430' => 2,
    '630' => 2,
    '640' => 2,
    '830' => 2,
    '840' => 2,
    '1030' => 2,
    '1130' => 2,
    '1230' => 2,
    '1240' => 2,
    '1330' => 2,
    '1430' => 3,
    '1440' => 3,
    '1530' => 3,
    '1630' => 3,
    '1730' => 3,
    '1830' => 4,
    '1930' => 4,
    '2030' => 4,
    '2130' => 4,
    '2230' => 4,
    '2300' => 4,
    '2330' => 4,
    '2430' => 4,
    '2530' => 4,
    '2630' => 4,
    '2730' => 4,
    '2830' => 4,
    '2930' => 5,
    '3300' => 5,
    '3100' => 6, // 3+3
    '4100' => 8, // 4+4
);

$kolKrepegOtSecheniyaStolba = array(
    '60*40' => 8,
    '60*60' => 8,
    '80*80' => 4,
);

$kolKrepegNaVorota = array( // êîëè÷åñòâî õîìóòîâ êîíöåâûõ  ìì îò âûñîòû âîğîò
    '1600' => 6,
    '1800' => 6,
    '2000' => 8, // äëÿ ôèò
    '2100' => 8,
    '2500' => 8,
);

$kolKrepegNaKalitku = array( // êîëè÷åñòâî õîìóòîâ êîíöåâûõ  ìì âûñîòû êàëèòêè
    '1600' => 6,
    '1800' => 6,
    '2000' => 8,  // äëÿ ôèò
    '2100' => 8,
    '2500' => 8,
);

$arSechenieStolbaPodVorota = array( // âûñîòà-øèğèíà => ñå÷åíèå

    'vorota_standart' => array( 
        '1600-3000' => '80*80',
        '1600-4000' => '80*80',
        '1600-5000' => '80*80',
        '1600-6000' => '80*80',
        '1800-3000' => '80*80',
        '1800-4000' => '80*80',
        '1800-5000' => '80*80',
        '1800-6000' => '100*100', // ïëàíêà ïğèæèìíàÿ
        '2100-3000' => '80*80',
        '2100-4000' => '80*80',
        '2100-5000' => '80*80',
        '2100-6000' => '100*100',  // ïëàíêà ïğèæèìíàÿ  
        '2500-3000' => '80*80',
        '2500-4000' => '80*80',
        '2500-5000' => '100*100', // ïëàíêà ïğèæèìíàÿ
        '2500-6000' => '100*100', // ïëàíêà ïğèæèìíàÿ
    ),
    
    'vorota_fit' => array(  // â òåòğàäè øèğèíà 3600, â áàçå 3500. äåëàåì ïî áàçå
        '1600-3500' => '80*80',
        '1800-3500' => '80*80',
        '2000-3500' => '80*80',
    ),
    
);

$arSechenieStolbaPodKalitku = array( // âûñîòà-øèğèíà => ñå÷åíèå
    '1600-1000' => '60*60',
    '1800-1000' => '60*60',
    '2100-1000' => '60*60',
    '2000-1000' => '60*60', //ôèò
    '2500-1000' => '80*80',
);

// äåëèòåëü äëÿ ğàññ÷¸òà êîëè÷åñòâà ïàíåëåé ïğè êğåïëåíèè õîìóò - Ìåæîñåâîå ğàññòîÿíèå,
$arKoefOtDliniISecheniya = array(
    '2400' => array(
        '60*40' => 2.48,
        '60*60' => 2.50,
        '80*80' => 2.52,
    ),
    '2500' => array(
        '60*40' => 2.58,
        '60*60' => 2.60,
        '80*80' => 2.62,
    ),
    '3000' => array(
        '60*40' => 3.08,
        '60*60' => 3.10,
        '80*80' => 3.12,
    ),
);
?>

<?
//ÑÎÒÂÅÒÑÒÂÈÅ òèïà ïàíåëè è øèğèíû è ÂÛÑÎÒ ÎÃĞÀÆÄÅÍÈß È ÑÅ×ÅÍÈß ÑÒÎËÁÎÂ
$arSechenieHeight = array( 
    'F' => array(
        '2500' =>array(
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
        ),
        
        '3000' =>array(
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.2',
                    ),
        ),
                
    ),
    
    'Î' => array(
        '2500' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2630' => array(
                        'HEIGHT_STOLBA' => 3500,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2830' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2930' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
        ), 
        
        '3000' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2630' => array(
                        'HEIGHT_STOLBA' => 3500,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2830' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2930' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
        ),         
    ),   
    
    'L' => array(
        '2500' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2930' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
        ), 
        
        '3000' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2830' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
        ),         
    ), 

    'Ì' => array(
        '2500' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1630' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1830' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '3100' => array( // 2030+1030
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '80*80*2',
                    ),
        ),     
    ),  
    
    'Å' => array(
        '2500' =>array(
            '640' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1040' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1240' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1440' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
        ),     
    ),  

    'P' => array( // âçÿòî îò O
        '2500' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2630' => array(
                        'HEIGHT_STOLBA' => 3500,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2830' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2930' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
        ), 
        
        '3000' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2630' => array(
                        'HEIGHT_STOLBA' => 3500,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2830' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2930' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
        ),         
    ),    
    
    'I' => array( // âçÿòî îò O
        '2500' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2630' => array(
                        'HEIGHT_STOLBA' => 3500,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2830' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2930' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
        ), 
        
        '3000' =>array(
            '630' => array(
                        'HEIGHT_STOLBA' => 1150,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1030' => array(
                        'HEIGHT_STOLBA' => 1500,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1230' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1430' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1530' => array(
                        'HEIGHT_STOLBA' => 2000,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1730' => array(
                        'HEIGHT_STOLBA' => 2300,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '1930' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2030' => array(
                        'HEIGHT_STOLBA' => 2600,
                        'SECHENIE_STOLBA' => '60*40*1.5',
                    ),
            '2230' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2430' => array(
                        'HEIGHT_STOLBA' => 3000,
                        'SECHENIE_STOLBA' => '60*60*1.5',
                    ),
            '2630' => array(
                        'HEIGHT_STOLBA' => 3500,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2830' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '2930' => array(
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '3100' => array( // 1530+1530
                        'HEIGHT_STOLBA' => 4000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
            '4100' => array( // 2030+2030
                        'HEIGHT_STOLBA' => 5000,
                        'SECHENIE_STOLBA' => '60*60*2',
                    ),
        ),         
    ),       
);
?>
<?
// ñå÷åíèå ñòîëáà ïàíåëè
preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'], $match);
$sechenieStolbaPaneli = $match[1];
/*?>
<div>
    Cå÷åíèå ñòîëáà ïàíåëè: <?=$sechenieStolbaPaneli?>
</div>
<?*/
$height_paneli = $arPost['height_paneli1'];

if((int)$arPost['perimetr'] > 0)
    $perimetr = (int)$arPost['perimetr'];
else
    $perimetr = (int)$arPost['summstoron'];

$realWidth = $arPost['width'];
if($arPost['width'] == 2400 ){  
    $arPost['width'] = 2500;
}

// if($arPost['width'] == 2500 && ($height_paneli == 2830 || $height_paneli == 2930) )    // äëÿ ıòèõ âûñîò (øèğèíà ïàíåëè 2400) - ñåé÷àñ ıòî ïğàâèëî àâòîìàòîì ğàáîòàåò íà îñíîâå äàííûõ èç áàçû
    // $dlinaPaneli = 2400 / 1000;
// else
    $dlinaPaneli = $realWidth / 1000;

if($arPost['color'] == 'öèíê'){
    $pokritie = 'öèíê';
    $colorValue = $arPost['color'];
}
else{
    $pokritie = 'öèíê+ïîëèìåğ';
    if($arPost['color'] == 'other_color'){
        $colorValue = $arPost['color_your'];
    }
    else{
        $colorValue = $arPost['color'];
    }
}


/*?>
<div>Äëèíà ïàíåëè: <?=$dlinaPaneli*1000?></div>
<?*/
$arParams = array();

$sechenieStolbaPodKalitku = $arSechenieStolbaPodKalitku[($arPost['height_kalitka']*10).'-'.($arPost['width_kalitka']*10)];  // Ñå÷åíèå ñòîëáà ïîä êàëèòêó: 
$sechenieStolbaPodVorota = $arSechenieStolbaPodVorota[$arPost['type_vorot']][($arPost['height_vorot']*10).'-'.($arPost['width_vorot']*10)];// Ñå÷åíèå ñòîëáà ïîä âîğîòà: 
p($sechenieStolbaPodVorota,'sechenieStolbaPodVorota');    
if($arPost['type_perimetr'] == 'nezamknut') // íåçàìêíóòûé ïåğèìåòğ
{
    $widthKalitka = $widthVorot = 0;
    if($arPost['kalitka'] == 'on'){
        $widthKalitka = $arPost['kol_kalitka'] * $arPost['width_kalitka'] / 100 ; // â ìåòğàõ
    }
    if($arPost['vorota'] == 'on' || $arPost['vorota1'] == 'on'){
        $widthVorot = $arPost['kol_vorot'] * $arPost['width_vorot'] / 100 ; // â ìåòğàõ
    }
// p($widthKalitka,'widthKalitka');
// p($widthVorot,'widthVorot');
    if($arPost['kreplenie'] == 'homut') // õîìóò
    {
        for($i=1; $i<=$arPost['cntStoron']; $i++)
        {

            $perimetr = $arPost['storona'.$i];
            //$sechenieStolbaPaneli = $arPost['sechenie_stolba'.$i];
            // ñå÷åíèå ñòîëáà ïàíåëè
            preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'.$i], $match);
            $sechenieStolbaPaneli = $match[1];
            
            $height_paneli = $arPost['height_paneli'.$i];
            $coefficientForKozirek = $arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli];
            
            
            $countPanels = ceil( ($perimetr - $widthKalitka - $widthVorot) / $arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli] ); // Êîëè÷åñòâî ïàíåëåé 
            $countStolbPaneli = $countPanels - $arPost['kol_kalitka'] - $arPost['kol_vorot'] + 1; // Êîëè÷åñòâî ñòîëáîâ=êîëè÷åñòâî ïàíåëåé+1=
            $countKrepegKKP = ($countStolbPaneli - 2) * $kolKrepegForHeightOgr[$height_paneli]; // Êîëè÷åñòâî êğåïåæåé ïğÿìûõ (ÊÊÏ)= (êîëè÷åñòâî ñòîëáîâ-2) õ Ê=(55-2)õ3=159
            $countKrepegKKPNabor = ceil($countKrepegKKP / 12); //êîëè÷åñòâî êğåïåæåé ïğÿìûõ â íàáîğå;
            $countKrepegKKK = 2 * $kolKrepegForHeightOgr[$height_paneli]; // Êîëè÷åñòâî êğåïåæåé êîíöåâûõ (ÊÊÊ)= êîëè÷åñòâî êğàéíèõ ñòîëáîâ õ Ê=2õ3=6
            
            // *8 – êîëè÷åñòâî êğåïåæåé â íàáîğå äëÿ ñòîëáîâ 60õ40,60õ60; 
            //*4 – êîëè÷åñòâî êğåïåæåé â íàáîğå äëÿ ñòîëáîâ 80õ80. 6/8=0.75>1 íàáîğ
            //preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'], $match);
            $countKrepegKKKNabor = ceil($countKrepegKKK / $kolKrepegOtSecheniyaStolba[$sechenieStolbaPaneli]);
        
            $arParams['PANELI'][] = array( // ìàññèâ ïàíåëåé
                'height_paneli' => $height_paneli,
                'sechenieStolbaPaneli' => $sechenieStolbaPaneli,
                'postSechenieStolbaPaneli' => $arPost['sechenie_stolba'.$i],
                'countStolbPaneli' => $countStolbPaneli,
                'countPanels' => $countPanels,
                'countKrepegKKP' => $countKrepegKKP,
                'countKrepegKKPNabor' => $countKrepegKKPNabor,
                'countKrepegKKK' => $countKrepegKKK,
                'countKrepegKKKNabor' => $countKrepegKKKNabor,
            );
        }
        /*?>
        <div>Êîëè÷åñòâî ïàíåëåé: <?=$countPanels?></div>
        <div>Êîëè÷åñòâî ñòîëáîâ äëÿ ïàíåëåé: <?=$countStolbPaneli?></div>
        <div>Êîëè÷åñòâî êğåïåæåé ïğÿìûõ: <?=$countKrepegKKP?></div>
        <div>Êîëè÷åñòâî íàáîğîâ êğåïåæåé ïğÿìûõ: <?=$countKrepegKKPNabor?></div>
        <div>Êîëè÷åñòâî êğåïåæåé êîíöåâûõ: <?=$countKrepegKKK?></div>
        <div>Êîëè÷åñòâî íàáîğîâ êğåïåæåé êîíöåâûõ : <?=$countKrepegKKKNabor?></div>
        <?*/
 
    }
    elseif($arPost['kreplenie'] == 'planka_prigim' || $arPost['kreplenie'] == 'planka_samores') // ïëàíêà
    {
        for($i=1; $i<=$arPost['cntStoron']; $i++)
        {

            $perimetr = $arPost['storona'.$i];
            //$sechenieStolbaPaneli = $arPost['sechenie_stolba'.$i];
            // ñå÷åíèå ñòîëáà ïàíåëè
            preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'.$i], $match);
            $sechenieStolbaPaneli = $match[1];
            $height_paneli = $arPost['height_paneli'.$i];
            $coefficientForKozirek = $arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli];
            
            $countPanels = ceil( ($perimetr - $widthKalitka - $widthVorot) / $dlinaPaneli); // Êîëè÷åñòâî ïàíåëåé 
            $countStolbPaneli = $countPanels - $arPost['kol_kalitka'] - $arPost['kol_vorot'] + 1; // Êîëè÷åñòâî ñòîëáîâ=êîëè÷åñòâî ïàíåëåé+1=
            $countKrepegKKP = $countStolbPaneli * $kolKrepegForHeightOgr[$height_paneli]; // Êîëè÷åñòâî êğåïåæåé ïğÿìûõ (ÊÊÏ)= (êîëè÷åñòâî ñòîëáîâ-2) õ Ê=(55-2)õ3=159
            $countKrepegKKPNabor = ceil($countKrepegKKP / 12); //êîëè÷åñòâî êğåïåæåé ïğÿìûõ â íàáîğå;
        
            $arParams['PANELI'][] = array( // ìàññèâ ïàíåëåé
                'height_paneli' => $height_paneli,
                'sechenieStolbaPaneli' => $sechenieStolbaPaneli,
                'postSechenieStolbaPaneli' => $arPost['sechenie_stolba'.$i],
                'countStolbPaneli' => $countStolbPaneli,
                'countPanels' => $countPanels,
                'countKrepegKKP' => $countKrepegKKP,
                'countKrepegKKPNabor' => $countKrepegKKPNabor,
            );
        }

        /*?>
        <div>Êîëè÷åñòâî ïàíåëåé: <?=$countPanels?></div>
        <div>Êîëè÷åñòâî ñòîëáîâ äëÿ ïàíåëåé: <?=$countStolbPaneli?></div>
        <div>Êîëè÷åñòâî êğåïåæåé: <?=$countKrepegKKP?></div>
        <?*/
    }
}
elseif($arPost['type_perimetr'] == 'zamknut') // çàìêíóòûé ïåğèìåòğ
{

    $widthKalitka = $widthVorot = 0;
    if($arPost['kalitka'] == 'on'){
        $widthKalitka = $arPost['kol_kalitka'] * $arPost['width_kalitka'] / 100 ; // â ìåòğàõ
    }
    else
        $arPost['kol_kalitka']=0;
    if($arPost['vorota'] == 'on' || $arPost['vorota1'] == 'on'){
        $widthVorot = $arPost['kol_vorot'] * $arPost['width_vorot'] / 100 ; // â ìåòğàõ
    }
    else
        $arPost['kol_vorot']=0;

// p($widthKalitka,'widthKalitka');
// p($widthVorot,'widthVorot');
    if($arPost['kreplenie'] == 'homut') // õîìóò
    {
        for($i=1; $i<=$arPost['cntStoron']; $i++)
        {

            $perimetr = $arPost['storona'.$i];
            //$sechenieStolbaPaneli = $arPost['sechenie_stolba'.$i];
            // ñå÷åíèå ñòîëáà ïàíåëè
            preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'.$i], $match);
            $sechenieStolbaPaneli = $match[1];
            
            $height_paneli = $arPost['height_paneli'.$i];
            $coefficientForKozirek = $arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli];
            
p($arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli], 'Äåëèòåëü');

            if($height_paneli == 4100 || $height_paneli == 3100){
                $countPanels = ceil( $perimetr / $arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli] ); // Êîëè÷åñòâî ïàíåëåé 
                $countStolbPaneli = $countPanels; // Êîëè÷åñòâî ñòîëáîâ=êîëè÷åñòâî ïàíåëåé-êîëè÷åñòâî âõîäíûõ ãğóïï          
                if( $arPost['type_ob'] == 'sport' || $arPost['type_ob'] == 'sport-other'){ //èñêëş÷åíèå
                    if($height_paneli == 4100)
                        $coefficient = 12;
                    else
                        $coefficient = 9;
                }
                else
                    $coefficient = $kolKrepegForHeightOgr[$height_paneli];
                
                $countKrepegKKP = $countStolbPaneli * $coefficient; // Êîëè÷åñòâî êğåïåæåé ïğÿìûõ=êîëè÷åñòâî ñòîëáîâ õ Ê=78õ4=312
                $countKrepegKKPNabor = ceil($countKrepegKKP / 12); //êîëè÷åñòâî êğåïåæåé ïğÿìûõ â íàáîğå;

            }
            else{
                $countPanels = ceil( ($perimetr - $widthKalitka - $widthVorot) / $arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli] ); // Êîëè÷åñòâî ïàíåëåé 
                $countStolbPaneli = $countPanels - $arPost['kol_kalitka'] - $arPost['kol_vorot']; // Êîëè÷åñòâî ñòîëáîâ=êîëè÷åñòâî ïàíåëåé-êîëè÷åñòâî âõîäíûõ ãğóïï
                $countKrepegKKP = $countStolbPaneli * $kolKrepegForHeightOgr[$height_paneli]; // Êîëè÷åñòâî êğåïåæåé ïğÿìûõ=êîëè÷åñòâî ñòîëáîâ õ Ê=78õ4=312
                $countKrepegKKPNabor = ceil($countKrepegKKP / 12); //êîëè÷åñòâî êğåïåæåé ïğÿìûõ â íàáîğå;
            }
            
p($coefficient, 'Êîåôôèöèåíò');
p($countKrepegKKP, 'Êîëè÷åñòâî êğåïåæåé ïğÿìûõ');
p($countPanels, 'Êîëè÷åñòâî ïàíåëåé');
p($height_paneli, 'âûñîòà ïàíåëè');
            

//p($countKrepegKKPNabor, 'êîëè÷åñòâî êğåïåæåé ïğÿìûõ â íàáîğå');
            /////
            $countKrepegKKK = $kolKrepegNaVorota[$arPost['height_vorot']*10] * (int)$arPost['kol_vorot'] + $kolKrepegNaKalitku[$arPost['height_kalitka']*10] * (int)$arPost['kol_kalitka']; // Êîëè÷åñòâî êğåïåæåé êîíöåâûõ (ÊÊÊ)=Êâ õ êîëè÷åñòâî âîğîò+Êâ õ êîëè÷åñòâî êàëèòîê =8õ1+8õ1=16
           // $countKrepegKKK = 0; // äëÿ âîğîò è êàëèòîâ ñ÷èòàåì îòäåëüíî êîëè÷åñòâî
p($countKrepegKKK, 'Êîëè÷åñòâî êğåïåæåé êîíöåâûõ');
p((int)$arPost['kol_vorot'], 'kol_vorot');
p((int)$arPost['kol_kalitka'], 'kol_kalitka');
            // *8 – êîëè÷åñòâî êğåïåæåé â íàáîğå äëÿ ñòîëáîâ 60õ40,60õ60; 
            //*4 – êîëè÷åñòâî êğåïåæåé â íàáîğå äëÿ ñòîëáîâ 80õ80. 6/8=0.75>1 íàáîğ
            //preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'], $match);
            $countKrepegKKKNabor = ceil($countKrepegKKK / $kolKrepegOtSecheniyaStolba[$sechenieStolbaPaneli]);
           
           //Êâ – ñîîòâåòñòâèå êîë-âà êğåïåæåé âûñîòå âõîäíûõ ãğóïï, ñì. ñë. 24-26
            // *8 – êîëè÷åñòâî êğåïåæåé â íàáîğå äëÿ ñòîëáîâ 60õ40,60õ60; 
            //*4 – êîëè÷åñòâî êğåïåæåé â íàáîğå äëÿ ñòîëáîâ 80õ80. 6/8=0.75>1 íàáîğ
            //preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'], $match);
            // $kolKrepegNaVorota = array( // êîëè÷åñòâî õîìóòîâ êîíöåâûõ  ìì îò âûñîòû âîğîò
            // $kolKrepegNaKalitku = array( // êîëè÷åñòâî õîìóòîâ êîíöåâûõ  ìì âûñîòû êàëèòêè
            
            $arParams['PANELI'][] = array( // ìàññèâ ïàíåëåé
                'height_paneli' => $height_paneli,
                'sechenieStolbaPaneli' => $sechenieStolbaPaneli,
                'postSechenieStolbaPaneli' => $arPost['sechenie_stolba'.$i],
                'countStolbPaneli' => $countStolbPaneli,
                'countPanels' => $countPanels,
                'countKrepegKKP' => $countKrepegKKP,
                'countKrepegKKPNabor' => $countKrepegKKPNabor,
                'countKrepegKKK' => $countKrepegKKK,
                'countKrepegKKKNabor' => $countKrepegKKKNabor,
            );
        } 
        
        $countKrepegKKKNaborKalitka = ceil($countKrepegKKK / $kolKrepegOtSecheniyaStolba[$sechenieStolbaPodKalitku]);
        $countKrepegKKKNaborVorota = ceil($countKrepegKKK / $kolKrepegOtSecheniyaStolba[$sechenieStolbaPodVorota]);
        
        /*?>
        <div>Êîëè÷åñòâî ïàíåëåé: <?=$countPanels?></div>
        <div>Êîëè÷åñòâî ñòîëáîâ äëÿ ïàíåëåé: <?=$countStolbPaneli?></div>
        <div>Êîëè÷åñòâî êğåïåæåé ïğÿìûõ: <?=$countKrepegKKP?></div>
        <div>Êîëè÷åñòâî íàáîğîâ êğåïåæåé ïğÿìûõ: <?=$countKrepegKKPNabor?></div>
        <div>Êîëè÷åñòâî êğåïåæåé êîíöåâûõ: <?=$countKrepegKKK?></div>
        <div>Êîëè÷åñòâî íàáîğîâ êğåïåæåé êîíöåâûõ äëÿ êàëèòêè: <?=$countKrepegKKKNaborKalitka?></div>
        <div>Êîëè÷åñòâî íàáîğîâ êğåïåæåé êîíöåâûõ äëÿ âîğîò: <?=$countKrepegKKKNaborVorota?></div>
        <?*/
 
    }
    elseif($arPost['kreplenie'] == 'planka_prigim' || $arPost['kreplenie'] == 'planka_samores') // ïëàíêà
    {
        for($i=1; $i<=$arPost['cntStoron']; $i++)
        {

            $perimetr = $arPost['storona'.$i];
            //$sechenieStolbaPaneli = $arPost['sechenie_stolba'.$i];
            // ñå÷åíèå ñòîëáà ïàíåëè
            preg_match('/([\d]+\*[\d]+)/', $arPost['sechenie_stolba'.$i], $match);
            $sechenieStolbaPaneli = $match[1];
            
            $height_paneli = $arPost['height_paneli'.$i];
            $coefficientForKozirek = $arKoefOtDliniISecheniya[$realWidth][$sechenieStolbaPaneli];
            
            $countPanels = ceil( ($perimetr - $widthKalitka - $widthVorot) / $dlinaPaneli); // Êîëè÷åñòâî ïàíåëåé 
            $countStolbPaneli = $countPanels - $arPost['kol_kalitka'] - $arPost['kol_vorot'] + 1; // Êîëè÷åñòâî ñòîëáîâ=êîëè÷åñòâî ïàíåëåé+1=
            $countKrepegKKP = $countStolbPaneli * $kolKrepegForHeightOgr[$height_paneli]; // Êîëè÷åñòâî êğåïåæåé ïğÿìûõ (ÊÊÏ)= (êîëè÷åñòâî ñòîëáîâ-2) õ Ê=(55-2)õ3=159
            $countKrepegKKPNabor = ceil($countKrepegKKP / 12); //êîëè÷åñòâî êğåïåæåé ïğÿìûõ â íàáîğå;
            
            $arParams['PANELI'][] = array( // ìàññèâ ïàíåëåé
                'height_paneli' => $height_paneli,
                'sechenieStolbaPaneli' => $sechenieStolbaPaneli,
                'postSechenieStolbaPaneli' => $arPost['sechenie_stolba'.$i],
                'countStolbPaneli' => $countStolbPaneli,
                'countPanels' => $countPanels,
                'countKrepegKKP' => $countKrepegKKP,
                'countKrepegKKPNabor' => $countKrepegKKPNabor,
            );
        }

        /*?>
        <div>Êîëè÷åñòâî ïàíåëåé: <?=$countPanels?> </div>
        <div>Êîëè÷åñòâî ñòîëáîâ äëÿ ïàíåëåé: <?=$countStolbPaneli?></div>
        <div>Êîëè÷åñòâî êğåïåæåé ïğÿìûõ: <?=$countKrepegKKP?></div>
        <?*/
    }
    /*?>
    
    <div>Ñå÷åíèå ñòîëáà ïîä êàëèòêó: <?=$sechenieStolbaPodKalitku?></div>
    <div>Ñå÷åíèå ñòîëáà ïîä âîğîòà: <?=$sechenieStolbaPodVorota?></div>
   <? */

}

//if (isset($arPost['WEB_FORM_ID']) && intval($arPost['WEB_FORM_ID']) > 0) {
p('ïîìåíÿòü âğåìÿ êåøèğîâàíèÿ');   
    
$arParamsTranslit = array("replace_space"=>"_","replace_other"=>"_");
//$el = new CIBlockElement;
$idIBlock = CATALOG_1C_IBLOCK_ID;
$arFilter = array(
    'IBLOCK_ID' => $idIBlock,  
    'ACTIVE' => 'Y',  
    //'SECTION_CODE' => 'paneli_ograzhdeniya',   
    'INCLUDE_SUBSECTIONS' => 'Y',   
);

$arVid = $arPokritie = $arWidth = $arHeight = $arYacheika = $arDiametr = $arVidDiametr = array();

$obCache = new \CPHPCache();
$cacheLifeTime = 1;//86400*60;
$cacheID = 'iblock_id_'.serialize($arPost);
$cacheDir = 's1/calculator';

if($obCache->InitCache($cacheLifeTime, $cacheID, $cacheDir) ) 
{
    $returnRes = $obCache->GetVars();		
}
elseif($obCache->StartDataCache())
{
    if (defined('BX_COMP_MANAGED_CACHE')) {

        $tagCache = new Bitrix\Main\Data\TaggedCache();
        $tagCache->startTagCache($cacheDir);
        $tagCache->registerTag(sprintf('iblock_id_%s', $idIBlock));
        $tagCache->endTagCache();
    }
    
    $countKKK_KPP = 0; // êîëè÷åñòâî êğåïëåíèé
    // ïîëó÷èì ïàíåëè
    $koefColPaneli = 1; // åñëè äâîéíûå ïàíåëè // 2030+2030 òî = 2

//p($arParams['PANELI'],'PANELI');
/*$arParams['PANELI'][] = array( // ìàññèâ ïàíåëåé
    'height_paneli' => $height_paneli,
    'sechenieStolbaPaneli' => $sechenieStolbaPaneli,
    'countStolbPaneli' => $countStolbPaneli,
    'countPanels' => $countPanels,
    'countKrepegKKP' => $countKrepegKKP,
    'countKrepegKKPNabor' => $countKrepegKKPNabor,
    'countKrepegKKK' => $countKrepegKKK,
);*/
    foreach($arParams['PANELI'] as $arPanel)
    {
       
        $height_paneli = $arPanel['height_paneli'];
        $countPanels = $arPanel['countPanels'];
        $countStolbPaneli = $arPanel['countStolbPaneli'];
        $sechenieStolbaPaneli = $arPanel['sechenieStolbaPaneli'];
        $postSechenieStolbaPaneli = $arPanel['postSechenieStolbaPaneli'];
        $countKrepegKKP = $arPanel['countKrepegKKP'];
        $countKrepegKKPNabor = $arPanel['countKrepegKKPNabor'];
        $countKrepegKKK = $arPanel['countKrepegKKK'];
        $countKrepegKKKNabor = $arPanel['countKrepegKKKNabor'];
        
        //$countKKK_KPP += ($countKrepegKKK + $countKrepegKKP);
        
        $arFilter = array(
            'IBLOCK_ID' => $idIBlock,  
            'ACTIVE' => 'Y',  
            'INCLUDE_SUBSECTIONS' => 'Y',  
            'PROPERTY_TYPE' => $arPost['type_panel'],  
            'PROPERTY_HEIGHT' => $height_paneli,  
            'PROPERTY_WIDTH' => $dlinaPaneli*1000,  
            'PROPERTY_POKRITIE' => $pokritie,  
        );
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME'/*, 'PROPERTY_TYPE', 'PROPERTY_POKRITIE', 'PROPERTY_HEIGHT', 'PROPERTY_VID', 'PROPERTY_WIDTH', 'PROPERTY_YACHEYKA', 'PROPERTY_DIAMETR', 'PROPERTY_VID_DIAMETR'*/);   
        if($height_paneli == 3100 || $height_paneli == 4100) // áóäåò èç äâóõ ïàíåëåé
        {
            if($height_paneli == 3100){
                if($arPost['type_panel'] == 'L' || $arPost['type_panel'] == 'Î' || $arPost['type_panel'] == 'P' || $arPost['type_panel'] == 'I'){ // 1530+1530
                    $koefColPaneli = 2;
                    $arFilter['PROPERTY_HEIGHT'] = 1530;
                    $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
                    while ($arEl = $res->GetNext())
                    {
                        //$arEl['COUNT'] = $countPanels*$koefColPaneli; // +1 ıòî íàğàùèâàíèå âûñîòû êàëèòêè 
                        $arEl['COUNT'] = $returnRes['PANELI']['ELEM'][$arEl['NAME']]['COUNT'] + $countPanels*$koefColPaneli;
                        $returnRes['PANELI']['ELEM'][$arEl['NAME']] = $arEl;
                                                
                    }
                    if(count($returnRes['PANELI']['ELEM']) == 0){
                        $returnRes['PANELI']['ERROR'][] = 'ïàíåëè òèïà '.$arType[$arPost['type_panel']].' öâåòà '.$colorValue.' è âûñîòîé 1600 íå íàéäåíû.';
                    }
                }
                elseif($arPost['type_panel'] == 'Ì'){ //2030+1030
                    $arFilter['PROPERTY_HEIGHT'] = 2030;
                    $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
                    while ($arEl = $res->GetNext())
                    {
                        //$arEl['COUNT'] = $countPanels*$koefColPaneli;
                        $arEl['COUNT'] = $returnRes['PANELI']['ELEM'][$arEl['NAME']]['COUNT'] + $countPanels*$koefColPaneli;
                        $returnRes['PANELI']['ELEM'][$arEl['NAME']] = $arEl; 
                    }
                    if(count($returnRes['PANELI']['ELEM']) == 0){
                        $returnRes['PANELI']['ERROR'][] = 'ïàíåëè òèïà '.$arType[$arPost['type_panel']].' öâåòà '.$colorValue.' è âûñîòîé 2100 íå íàéäåíû.';
                    }
                    
                    $arFilter['PROPERTY_HEIGHT'] = 1030;
                    $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
                    while ($arEl = $res->GetNext())
                    {
                        //$arEl['COUNT'] = $countPanels*$koefColPaneli;
                        $arEl['COUNT'] = $returnRes['PANELI']['ELEM'][$arEl['NAME']]['COUNT'] + $countPanels*$koefColPaneli;
                        $returnRes['PANELI']['ELEM'][$arEl['NAME']] = $arEl; 
                    }
                    if(count($returnRes['PANELI']['ELEM']) == 0){
                        $returnRes['PANELI']['ERROR'][] = 'ïàíåëè òèïà '.$arType[$arPost['type_panel']].' öâåòà '.$colorValue.' è âûñîòîé 1100 íå íàéäåíû.';
                    }
                }
            }
            elseif($height_paneli == 4100){ 
            
                $koefColPaneli = 2;
                $arFilter['PROPERTY_HEIGHT'] = 2030;
                $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
                while ($arEl = $res->GetNext())
                {
                    //$arEl['COUNT'] = $countPanels*$koefColPaneli;
                    $arEl['COUNT'] = $returnRes['PANELI']['ELEM'][$arEl['NAME']]['COUNT'] + $countPanels*$koefColPaneli;
                    $returnRes['PANELI']['ELEM'][$arEl['NAME']] = $arEl; 
                }
                if(count($returnRes['PANELI']['ELEM']) == 0){
                    $returnRes['PANELI']['ERROR'][] = 'ïàíåëè òèïà '.$arType[$arPost['type_panel']].' öâåòà '.$colorValue.' è âûñîòîé 2100  íå íàéäåíû.';
                } 
            }
        }
        else{  
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            while ($arEl = $res->GetNext())
            {
                //$arEl['COUNT'] += $countPanels*$koefColPaneli;
                $arEl['COUNT'] = $returnRes['PANELI']['ELEM'][$arEl['NAME']]['COUNT'] + $countPanels*$koefColPaneli;
                $returnRes['PANELI']['ELEM'][$arEl['NAME']] = $arEl; 
            }
            if(count($returnRes['PANELI']['ELEM']) == 0){
                $returnRes['PANELI']['ERROR'][] = 'ïàíåëè äëèíîé '.($dlinaPaneli*1000).' òèïà '.$arType[$arPost['type_panel']].' è âûñîòîé '.$height_paneli.' öâåòà '.$colorValue.' íå íàéäåíû.';
            }
        }

        
        // ïîëó÷èì Íàáîğ êîìïëåêòîâ êğåïåæà ïğÿìîãî 
        $arFilter = array(
            'IBLOCK_ID' => $idIBlock,  
            'ACTIVE' => 'Y',
            'SECTION_CODE' => 'komplekty_krepezha', 
            'INCLUDE_SUBSECTIONS' => 'Y',  
            'PROPERTY_TYPE' => 'ÊÊÏ',
            'PROPERTY_SECHENIE' => $sechenieStolbaPaneli,  // ñå÷åíèå ñòîëáà ïàíåëè
            'PROPERTY_POKRITIE' => $pokritie,  
        );
        
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        
        while ($arEl = $res->GetNext())
        {
    //p($arEl);
            //$arEl['COUNT'] = $countKrepegKKPNabor;
            $arEl['COUNT'] = $returnRes['NABOR_KKP']['ELEM'][$sechenieStolbaPaneli.$pokritie]['COUNT'] += $countKrepegKKP;
            $returnRes['NABOR_KKP']['ELEM'][$sechenieStolbaPaneli.$pokritie] = $arEl;
        }
        if(count($returnRes['NABOR_KKP']['ELEM']) == 0){
            $returnRes['NABOR_KKP']['ERROR'][] = 'Íàáîğ êîìïëåêòîâ êğåïåæà ïğÿìîãî íà ñå÷åíèå ñòîëáà ïàíåëè '.$sechenieStolbaPaneli.' ïîêğûòèå '.$pokritie.' íå íàéäåíû.';
        } 
        
        // ïîëó÷èì Íàáîğ êîìïëåêòîâ êğåïåæà êîíöåâîãî äëÿ ïàíåëè 
        if($countKrepegKKK > 0) // äëÿ íå çàìêíóòîãî ïåğèìåòğà
        {
            $arFilter = array(
                'ACTIVE' => 'Y',
                'IBLOCK_ID' => $idIBlock,  
                'SECTION_CODE' => 'komplekty_krepezha',   
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_TYPE' => 'ÊÊÊ',
                'PROPERTY_SECHENIE' => $sechenieStolbaPaneli,  
                'PROPERTY_POKRITIE' => $pokritie,  
            );
            
            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            {
                //$arEl['COUNT'] = $countKrepegKKKNabor;
                $arEl['COUNT'] = $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPaneli.$pokritie]['COUNT'] += $countKrepegKKK;// êîëè÷åñòâî êğåïåæåé êîíöåâûõ
                $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPaneli.$pokritie] = $arEl;
                $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPaneli.$pokritie]['COUNT_IN_NABOR'] += $kolKrepegOtSecheniyaStolba[$sechenieStolbaPaneli]; // êîëè÷åñòâî êğåïåæåé êîíöåâûõ
            }
            if(count($returnRes['NABOR_KKK']['ELEM']) == 0){
                $returnRes['NABOR_KKK']['ERROR'][] = 'Íàáîğ êîìïëåêòîâ êğåïåæà êîíöåâîãî íà ñå÷åíèå ñòîëáà ïàíåëè '.$sechenieStolbaPaneli.' ïîêğûòèå '.$pokritie.' íå íàéäåíû.';
            }  
        }
        //âûñîòà ñòîëáà$arSechenieHeight = array( 
        $heightStolbaPanli = $arSechenieHeight[$arPost['type_panel']][$arPost['width']][$height_paneli]['HEIGHT_STOLBA'];

        // ïîëó÷èì ñòîëáû äëÿ ïàíåëåé
        $arFilter = array(
            'IBLOCK_ID' => $idIBlock,  
            'ACTIVE' => 'Y',
            'SECTION_CODE' => 'stolby_ograzhdeniya_gardis_s_07_2014',   
            'INCLUDE_SUBSECTIONS' => 'Y',  
            'PROPERTY_SECHENIE' => $postSechenieStolbaPaneli,
            'PROPERTY_HEIGHT' => $heightStolbaPanli,//ceil($height_paneli/100) * 100,  
            'PROPERTY_TYPE_INSTALL' => $arPost['type_install_stolba'],  
            'PROPERTY_POKRITIE' => $pokritie, 
        );
        
       
        if($arPost['type_install_stolba'] == 'ïîä áåòîíèğîâàíèå'){
            $vidStolba = 'ÑÎÏ';
            if($arPost['shtanga'] == 'on'){
                $vidStolba .= 'Ø';
            }
        }
        elseif($arPost['type_install_stolba'] == 'íà ôëàíöàõ'){
            $vidStolba = 'ÑÎÏÔ';
            if($arPost['shtanga'] == 'on'){
                $vidStolba .= 'Ø';
            }
        }
        elseif($arPost['type_install_stolba'] == 'ñî ñú¸ìíûì ôëàíöåì'){
            $vidStolba = 'ÑÎÏÔ';
            if($arPost['shtanga'] == 'on'){
                $vidStolba .= 'Ø';
            }
            
            // ïîëó÷èì Êîìïëåêò îïîğû ñòîëáà îãğàæäåíèÿ ÊÎ.160.60.60.40
            //Êîìïëåêò îïîğû ñòîëáà îãğàæäåíèÿ ÊÎ.160.60.60.40.RAL
            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $arFilterKoplect = array(
                'IBLOCK_ID' => $idIBlock,  
                'ACTIVE' => 'Y',
                'SECTION_CODE' => 'komplekty_krepezha',   
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'NAME' => 'Êîìïëåêò îïîğû ñòîëáà îãğàæäåíèÿ ÊÎ.160.60.60.40.RAL',  
            );
            $res = CIBlockElement::GetList(Array(), $arFilterKoplect, false, false, $arSelect);
            if ($res->SelectedRowsCount() > 0)
            {
                while ($arEl = $res->GetNext())
                {
                    $arEl['COUNT'] = $returnRes['KOMPLEKT_KO']['ELEM']['ÊÎ.160.60.60.40.RAL']['COUNT'] + $countStolbPaneli;
                    $returnRes['KOMPLEKT_KO']['ELEM']['ÊÎ.160.60.60.40.RAL'] = $arEl;
                    
                }
            }
            else{
                $returnRes['KOMPLEKT_KO']['ERROR'][''] = 'Êîìïëåêò îïîğû ñòîëáà îãğàæäåíèÿ ÊÎ.160.60.60.40 äëÿ ïàíåëåé íå íàéäåí.';
            }
        }
        
        $arFilter['PROPERTY_VID_STOLBA'] = $vidStolba;
        
//p($arFilter,'arFilter ñòîëáû');
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        if ($res->SelectedRowsCount() > 0)
        {
            while ($arEl = $res->GetNext())
            {
        //p($arEl);
        //p($arEl['NAME'],'ñòîëáû ïîä ïàíåëè: ');
                $arEl['COUNT'] = $returnRes['STOLBI_FOR_PANELI']['ELEM'][$arEl['ID']]['COUNT'] + $countStolbPaneli;
                $returnRes['STOLBI_FOR_PANELI']['ELEM'][$arEl['ID']] = $arEl;
                
        // p($arEl['PROPERTY_TYPE_VALUE'],'PROPERTY_TYPE_VALUE'); 
            }
        }
        else{
            $returnRes['STOLBI_FOR_PANELI']['ERROR'][] = 'Ñòîëáû äëÿ ïàíåëåé '.$arPost['type_install_stolba'].' ïîêğûòèåì '.$pokritie.' âûñîòîé '.$heightStolbaPanli.' âèäà '.$vidStolba.' è ñå÷åíèåì '.$postSechenieStolbaPaneli.' íå íàéäåíû.';
        }
        
        // Øòàíãè
        if($arPost['shtanga'] == 'on'){
            // ïîëó÷èì Øòàíãè
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock, 
                'ACTIVE' => 'Y',
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_TYPE' => $arPost['type_shtanga'],
                'PROPERTY_DLINA' => $arPost['dlina_shtanga'],  
                'PROPERTY_USILENNOE' => 0,  
                'PROPERTY_SECHENIE' => $sechenieStolbaPaneli,  
            );
    //p($arFilter,'arFilter Øòàíãè: ');
            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            {
        //p($arEl);
                $arEl['COUNT'] = $countStolbPaneli;
                $returnRes['STANGI']['ELEM'][] = $arEl;
            }
            if(count($returnRes['STANGI']['ELEM']) == 0){
                $returnRes['STANGI']['ERROR'][] = 'Øòàíãè äëÿ ñòîëáîâ ïàíåëåé òèïà '.$arPost['type_shtanga'].' äëèíîé '.$arPost['dlina_shtanga'].' ñå÷åíèåì '.$sechenieStolbaPaneli.' öâåòîì '.$colorValue.' íå íàéäåíû.';
            }   
//p($returnRes['STANGI'], 'STANGI');
        }
    }
    
    // âîğîòà
    if($arPost['vorota'] == 'on'){
        // ïîëó÷èì âîğîòà
        if($arPost['type_vorot'] != 'vorota_otkatnie')
        {
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock,
                'ACTIVE' => 'Y',            
                'SECTION_CODE' => 'vorota_raspashnye',   
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_TYPE' => 'Ì',//$arPost['type_panel'],
                'PROPERTY_HEIGHT' => $arPost['height_vorot'],  
                'PROPERTY_WIDTH' => $arPost['width_vorot'],  
                'PROPERTY_TYPE_INSTALL' => $arPost['type_install_vorot'],  
            );
            if($arPost['type_vorot'] != 'vorota_fit'){
                $arFilter['PROPERTY_OTKRIVANIE'] = $arPost['type_open_vorot'];  
            }
            else{
                $arFilter['PROPERTY_TYPE'] = 'F';  
            } 
            
            if(($arPost['type_ob'] == 'sport' || $arPost['type_ob'] == 'sport-other') && $arPost['type_panel'] != 'Î')
                $arFilter['PROPERTY_VID'] = '2D';	
            else
                $arFilter['PROPERTY_VID'] = '3D';
        }
        else{
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock,
                'ACTIVE' => 'Y',            
                'SECTION_CODE' => 'vorota_otkatnye',   
                'INCLUDE_SUBSECTIONS' => 'Y',  
                //'PROPERTY_TYPE' => 'Ì',//$arPost['type_panel'],
                'PROPERTY_HEIGHT' => $arPost['height_vorot']*10,  
                'PROPERTY_WIDTH' => $arPost['width_vorot']*10,  
                //'PROPERTY_TYPE_INSTALL' => $arPost['type_install_vorot'],  
                'PROPERTY_OTKRIVANIE' => $arPost['type_open_vorot'],  
            );
        }
 
//p($arFilter,'arFilter âîğîòà: ');
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        
        while ($arEl = $res->GetNext())
        {
    //p($arEl);
            $arEl['COUNT'] = $arPost['kol_vorot'];
            $returnRes['VOROTA']['ELEM'][] = $arEl;
    // p($arEl['PROPERTY_TYPE_VALUE'],'PROPERTY_TYPE_VALUE'); 
        }
        if(count($returnRes['VOROTA']['ELEM']) == 0){
            $returnRes['VOROTA']['ERROR'][] = 'Âîğîòà âûñîòîé '.($arPost['height_vorot']*10).' øèğèíîé '.($arPost['width_vorot']*10).' óñòàíîâêîé '.$arPost['type_install_vorot'].' îòêğûâàíèå '.$arPost['type_open_vorot'].'  âèäà '.$arFilter['PROPERTY_VID'].' íå íàéäåíû.';
        } 
        
        if($arPost['width_vorot'] == 600 && $arPost['type_vorot'] != 'vorota_otkatnie'){
             $arFilter = array(
                'IBLOCK_ID' => $idIBlock,  
                'ACTIVE' => 'Y',
                'SECTION_CODE' => 'komplekty_krepezha',   
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'NAME' => 'Ïëàíêà ïğèæèìíàÿ ÏÏ.40.30 ïîëèìåğ', 
            );

            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            { 
                $kolKKK = $kolKrepegNaVorota[$arPost['height_vorot']*10] * $arPost['kol_vorot'];
                $returnRes['PLANKA']['ELEM'][$arEl['NAME']] = $arEl;
                $returnRes['PLANKA']['ELEM'][$arEl['NAME']]['COUNT'] += $kolKKK ;
                $returnRes['PLANKA']['ELEM'][$arEl['NAME']]['COUNT_IN_NABOR'] = $kolKrepegOtSecheniyaStolba[$sechenieStolbaPodVorota] ;
                
                //$countKKK_KPP += $kolKKK;
            }
            if(count($returnRes['PLANKA']['ELEM']) == 0){
                $returnRes['PLANKA']['ERROR'][] = 'Ïëàíêà ïğèæèìíàÿ ÏÏ.40.30 ïîëèìåğ íå íàéäåíà.';
            }
        }
        else{
            // ïîëó÷èì Õîìóòû êîíöåâûå íà âîğîòà = Íàáîğ êîìïëåêòîâ êğåïåæà êîíöåâîãî ÊÊÊ.60.60.20.RAL (8) èëè Íàáîğ êîìïëåêòîâ êğåïåæà ïğÿìîãî ÊÊÏ.60.40.20.ZC (12) 
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock,  
                'ACTIVE' => 'Y',
                'SECTION_CODE' => 'komplekty_krepezha',   
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_TYPE' => 'ÊÊÊ',
                'PROPERTY_SECHENIE' => $sechenieStolbaPodVorota,  
                'PROPERTY_POKRITIE' => $pokritie,  
            );

            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            { 
                $kolKKK = $kolKrepegNaVorota[$arPost['height_vorot']*10] * $arPost['kol_vorot'];
                $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPodVorota.$pokritie] = $arEl;
                $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPodVorota.$pokritie]['COUNT'] += $kolKKK ;
                $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPodVorota.$pokritie]['COUNT_IN_NABOR'] = $kolKrepegOtSecheniyaStolba[$sechenieStolbaPodVorota] ;
                
                //$countKKK_KPP += $kolKKK;
            }
            if(count($returnRes['NABOR_KKK']['ELEM']) == 0){
                $returnRes['NABOR_KKK']['ERROR'][] = 'Õîìóòû êîíöåâûå íà âîğîòà ñå÷åíèåì '.$sechenieStolbaPodVorota.' ïîêğûòèåì '.$pokritie.' c óêàçàíûìè ğàçìåğàìè íå íàéäåíû.';
            }   
        }
       

        // Øòàíãè
        /*if($arPost['shtanga'] == 'on'){
            // ïîëó÷èì Øòàíãè
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock, 
                'ACTIVE' => 'Y',
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_TYPE' => $arPost['type_shtanga'],
                'PROPERTY_DLINA' => $arPost['dlina_shtanga'],  
                'PROPERTY_USILENNOE' => 0,  
                'PROPERTY_SECHENIE' => $sechenieStolbaPaneli,  
            );
    //p($arFilter,'arFilter Øòàíãè: ');
            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            {
        //p($arEl);
                $arEl['COUNT'] = $arPost['kol_vorot']*2;
                $returnRes['STANGI']['ELEM'][] = $arEl;
            }
            if(count($returnRes['STANGI']['ELEM']) == 0){
                $returnRes['STANGI']['ERROR'][] = 'Øòàíãè äëÿ âîğîò òèïà '.$arPost['type_shtanga'].' äëèíîé '.$arPost['dlina_shtanga'].' ñå÷åíèåì '.$sechenieStolbaPaneli.' öâåòîì '.$colorValue.' íå íàéäåíû.';
            }   
//p($returnRes['STANGI']['ELEM'], 'STANGI');
        }   */   
        

        // ïîëó÷èì ñòîëáû äëÿ âîğîò
        /*$arFilter = array(
            'IBLOCK_ID' => $idIBlock,  
            'ACTIVE' => 'Y',
            'SECTION_CODE' => 'stolby_ograzhdeniya_gardis_s_07_2014',   
            'INCLUDE_SUBSECTIONS' => 'Y',  
            '%PROPERTY_SECHENIE' => $sechenieStolbaPodVorota,
            'PROPERTY_HEIGHT' => $heightStolbaPanli,//ceil($height_paneli/100) * 100,   // áåğ¸ì ñòîëáû òàêîé æå âûñîòû êàê ïîä ïàíåëè
            'PROPERTY_TYPE_INSTALL' => $arPost['type_install_vorot'],  
            'PROPERTY_POKRITIE' => $pokritie, 
        );
        if($arPost['type_install_vorot'] == 'ïîä áåòîíèğîâàíèå'){
            $vidStolba = 'ÑÎÏ';
            if($arPost['shtanga'] == 'on'){
                $vidStolba .= 'Ø';
            }
        }
        elseif($arPost['type_install_vorot'] == 'íà ôëàíöàõ'){
            $vidStolba = 'ÑÎÏÔ';
            if($arPost['shtanga'] == 'on'){
                $vidStolba .= 'Ø';
            }
        }  

        $arFilter['PROPERTY_VID_STOLBA'] = $vidStolba;
        
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        if ($res->SelectedRowsCount() > 0)
        {
            while ($arEl = $res->GetNext())
            {
                $arEl['COUNT'] = $arPost['kol_vorot']*2;
                $returnRes['STOLBI_FOR_VOROT']['ELEM'][] = $arEl;
            }
        }
        else{
            $returnRes['STOLBI_FOR_VOROT']['ERROR'][] = 'Ñòîëáû äëÿ âîğîò '.$arPost['type_install_vorot'].' ïîêğûòèåì '.$pokritie.' âûñîòîé '.$heightStolbaPanli.' âèäà '.$vidStolba.' è ñå÷åíèåì '.$sechenieStolbaPodVorota.' íå íàéäåíû.';
        }  */      
    }
    
    // êàëèòêè
    if($arPost['kalitka'] == 'on'){
        
        // ïîëó÷èì êàëèòêè
        $arFilter = array(
            'IBLOCK_ID' => $idIBlock, 
            'ACTIVE' => 'Y',
            'INCLUDE_SUBSECTIONS' => 'Y',  
            'PROPERTY_TYPE' => 'Ì',//$arPost['type_panel'],
            'PROPERTY_HEIGHT' => $arPost['height_kalitka'],  
            'PROPERTY_WIDTH' => $arPost['width_kalitka'],   
            'PROPERTY_TYPE_INSTALL' => $arPost['type_install_kalitka'],  
        );
        if($arPost['type_kalitka'] != 'kalitka_fit'){
            $arFilter['PROPERTY_OTKRIVANIE'] = $arPost['type_open_kalitka'];  
        }
        else{
            $arFilter['PROPERTY_TYPE'] = 'F';  
        }
        
        if($arPost['type_install_kalitka'] == 'ïîä áåòîíèğîâàíèå')
            $arFilter['SECTION_CODE'] = 'kalitki_raspashnye_stolby_pod_betonirovanie';	
        else
            $arFilter['SECTION_CODE'] = 'kalitki_raspashnye_stolby_s_flantsem';	
        
        if(($arPost['type_ob'] == 'sport' || $arPost['type_ob'] == 'sport-other') && $arPost['type_panel'] != 'Î')
            $arFilter['PROPERTY_VID'] = '2D';	
        else
            $arFilter['PROPERTY_VID'] = '3D';	
        

            
//p($arFilter,'arFilter êàëèòêè: ');
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        
        while ($arEl = $res->GetNext())
        {
    //p($arEl);
            $arEl['COUNT'] = $arPost['kol_kalitka'];
            $returnRes['KALITKA']['ELEM'][] = $arEl;
    // p($arEl['PROPERTY_TYPE_VALUE'],'PROPERTY_TYPE_VALUE'); 
        }
        if(count($returnRes['KALITKA']['ELEM']) == 0){
            $returnRes['KALITKA']['ERROR'][] = 'Êàëèòêè âûñîòîé '.($arPost['height_kalitka']*10).' øèğèíîé '.($arPost['width_kalitka']*10).' óñòàíîâêîé '.$arPost['type_install_kalitka'].' îòêğûâàíèå '.$arFilter['PROPERTY_OTKRIVANIE'].'  âèäà '.$arFilter['PROPERTY_VID'].' íå íàéäåíû.';;
        } 

        // ïîëó÷èì Õîìóòû êîíöåâûå íà êàëèòêè = Íàáîğ êîìïëåêòîâ êğåïåæà êîíöåâîãî ÊÊÊ.60.60.20.RAL (8) èëè Íàáîğ êîìïëåêòîâ êğåïåæà ïğÿìîãî ÊÊÏ.60.40.20.ZC (12) 
        $arFilter = array(
            'IBLOCK_ID' => $idIBlock,
            'ACTIVE' => 'Y',
            'SECTION_CODE' => 'komplekty_krepezha',   
            'INCLUDE_SUBSECTIONS' => 'Y',  
            'PROPERTY_TYPE' => 'ÊÊÊ',
            'PROPERTY_SECHENIE' => $sechenieStolbaPodKalitku,  
            'PROPERTY_POKRITIE' => $pokritie,  
        );
        
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        
        while ($arEl = $res->GetNext())
        {
            $kolKKK = $kolKrepegNaKalitku[$arPost['height_kalitka']*10] * $arPost['kol_kalitka'];
            $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPodKalitku.$pokritie] = $arEl;
            $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPodKalitku.$pokritie]['COUNT'] += $kolKKK;
            $returnRes['NABOR_KKK']['ELEM'][$sechenieStolbaPodKalitku.$pokritie]['COUNT_IN_NABOR'] += $kolKrepegOtSecheniyaStolba[$sechenieStolbaPodKalitku];
            //$countKKK_KPP += $kolKKK;
        }
        if(count($returnRes['NABOR_KKK']['ELEM']) == 0){
            $returnRes['NABOR_KKK']['ERROR'][] = 'Õîìóòû êîíöåâûå íà êàëèòêè c óêàçàíûìè ğàçìåğàìè íå íàéäåíû.';
        }   

        // Øòàíãè
        /*if($arPost['shtanga'] == 'on'){
            // ïîëó÷èì Øòàíãè
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock, 
                'ACTIVE' => 'Y',
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_TYPE' => $arPost['type_shtanga'],
                'PROPERTY_DLINA' => $arPost['dlina_shtanga'],  
                'PROPERTY_USILENNOE' => 0,  
                'PROPERTY_SECHENIE' => $sechenieStolbaPaneli,  
            );
//p($arFilter,'arFilter Øòàíãè: ');
            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            {
        //p($arEl);
                $arEl['COUNT'] = $arPost['kol_kalitka']*2;
                $returnRes['STANGI']['ELEM'][] = $arEl;
            }
            if(count($returnRes['STANGI']['ELEM']) == 0){
                $returnRes['STANGI']['ERROR'][] = 'Øòàíãè äëÿ êàëèòîê òèïà '.$arPost['type_shtanga'].' äëèíîé '.$arPost['dlina_shtanga'].' ñå÷åíèåì '.$sechenieStolbaPaneli.' öâåòîì '.$colorValue.' íå íàéäåíû.';
            }   
//p($returnRes['STANGI']['ELEM'], 'STANGI');
        } */
        
        // ïîëó÷èì ñòîëáû äëÿ êàëèòîê
        /*$arFilter = array(
            'IBLOCK_ID' => $idIBlock,  
            'ACTIVE' => 'Y',
            'SECTION_CODE' => 'stolby_ograzhdeniya_gardis_s_07_2014',   
            'INCLUDE_SUBSECTIONS' => 'Y',  
            '%PROPERTY_SECHENIE' => $sechenieStolbaPodKalitku,
            'PROPERTY_HEIGHT' => $heightStolbaPanli,//ceil($height_paneli/100) * 100,   // áåğ¸ì ñòîëáû òàêîé æå âûñîòû êàê ïîä ïàíåëè
            'PROPERTY_TYPE_INSTALL' => $arPost['type_install_kalitka'],  
            'PROPERTY_POKRITIE' => $pokritie, 
        );
        if($arPost['type_install_kalitka'] == 'ïîä áåòîíèğîâàíèå'){
            $vidStolba = 'ÑÎÏ';
            if($arPost['shtanga'] == 'on'){
                $vidStolba .= 'Ø';
            }
        }
        elseif($arPost['type_install_kalitka'] == 'íà ôëàíöàõ'){
            $vidStolba = 'ÑÎÏÔ';
            if($arPost['shtanga'] == 'on'){
                $vidStolba .= 'Ø';
            }
        }  

        $arFilter['PROPERTY_VID_STOLBA'] = $vidStolba;
        
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        if ($res->SelectedRowsCount() > 0)
        {
            while ($arEl = $res->GetNext())
            {
                $arEl['COUNT'] = $arPost['kol_kalitka']*2;
                $returnRes['STOLBI_FOR_KALITKA']['ELEM'][] = $arEl;
            }
        }
        else{
            $returnRes['STOLBI_FOR_KALITKA']['ERROR'][] = 'Ñòîëáû äëÿ êàëèòêè '.$arPost['type_install_kalitka'].' ïîêğûòèåì '.$pokritie.' âûñîòîé '.$heightStolbaPanli.' âèäà '.$vidStolba.' è ñå÷åíèåì '.$sechenieStolbaPodKalitku.' íå íàéäåíû.';
        }*/
    }
    
    // ÿãîçà ÑÁÁ
    if($arPost['egoza_sbb'] == 'on'){// ïåğèìåòğ
        // ïîëó÷èì ÿãîçó
        $cntSbb = count($arPost['egoza_perimetr_sbb']);
        for($i=0; $i < $cntSbb; $i++)
        {
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock, 
                'ACTIVE' => 'Y',
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_DIAMETR_YAGOZI' => $arPost['diametr_yagozi_sbb'][$i] , // äèàìåòğ
                'PROPERTY_KOL_VITKOV' => $arPost['kol_vitkov_yagozi_sbb'][$i] ,  
                'TYPE' => 'ÑÁÁ',  
            );
            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            {
                $arEl['COUNT'] = ceil($arPost['egoza_perimetr_sbb'][$i] / 10);
                $returnRes['SBB']['ELEM'][] = $arEl;
            }
            if(count($returnRes['SBB']['ELEM']) == 0){
                $returnRes['SBB']['ERROR'][] = 'ÑÁÁ Åãîçà äèàìåòğîì '.$arPost['diametr_yagozi_sbb'][$i] .' êîëè÷åñòâî âèòêîâ '.$arPost['kol_vitkov_yagozi_sbb'][$i] .' íå íàéäåíà. ('.($arPost['egoza_perimetr_sbb'][$i]  / 10).' áóõò)';
            }   
        }
    }
    
    // ÿãîçà ÏÁÁ
    if($arPost['egoza_pbb'] == 'on'){// ïåğèìåòğ
        // ïîëó÷èì ÿãîçó
        $cntSbb = count($arPost['egoza_perimetr_pbb']);
        for($i=0; $i < $cntSbb; $i++)
        {
            $arFilter = array(
                'IBLOCK_ID' => $idIBlock, 
                'ACTIVE' => 'Y',
                'INCLUDE_SUBSECTIONS' => 'Y',  
                'PROPERTY_DIAMETR_YAGOZI' => $arPost['diametr_yagozi_pbb'][$i], // äèàìåòğ
                'PROPERTY_KOL_VITKOV' => $arPost['kol_vitkov_yagozi_pbb'][$i],  
                'TYPE' => 'ÏÁÁ', 
            );
            $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
            $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
            
            while ($arEl = $res->GetNext())
            {
                $arEl['COUNT'] = ceil($arPost['egoza_perimetr_pbb'][$i] / 10);
                $returnRes['PBB']['ELEM'][] = $arEl;
            }
            if(count($returnRes['PBB']['ELEM']) == 0){
                $returnRes['PBB']['ERROR'][] = 'ÏÁÁ Åãîçà äèàìåòğîì '.$arPost['diametr_yagozi_pbb'][$i].' êîëè÷åñòâî âèòêîâ '.$arPost['kol_vitkov_yagozi_pbb'][$i].' íå íàéäåíà. ('.($arPost['egoza_perimetr_pbb'][$i] / 10).' áóõò)';
            }   
        }   
    }
p($coefficientForKozirek, 'coefficientForKozirek');
    // êîçûğ¸ê
    if($arPost['kozirek'] == 'on'){
        $arFilter = array(
            'IBLOCK_ID' => $idIBlock, 
            'ACTIVE' => 'Y',
            'INCLUDE_SUBSECTIONS' => 'Y',  
        );
        
        if($arPost['type_panel'] == 'Î'){
            $arFilter['NAME'] = 'Ïàíåëü îãğàæäåíèÿ Ï-Î3D.2500.630.200.55.4,8.4,8.RAL';
        }
        else{
            $arFilter['NAME'] = 'Ïàíåëü îãğàæäåíèÿ Ï-Ì2D.2500.630.200.55.5.6õ2.RAL';
        }
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        
        if ($arEl = $res->GetNext())
        {

            $arEl['COUNT'] = ceil($arPost['kozirek_perimetr'] / $coefficientForKozirek);
            
            $returnRes['kozirek']['ELEM'][] = $arEl;
        }
        if(count($returnRes['kozirek']['ELEM']) == 0){
            $returnRes['kozirek']['ERROR'][] = 'Êîçûğ¸ê íå íàéäåí';
        }   
    }
    
     // Àíòèâàíäàëüíûé êğåï¸æ
    if($arPost['antivand_krepeg'] == 'on'){
        $arFilter = array(
            'IBLOCK_ID' => $idIBlock, 
            'ACTIVE' => 'Y',
            'INCLUDE_SUBSECTIONS' => 'Y',  
            'NAME' => 'Ãàéêà Ì6 àíòèâàíä',
            'PROPERTY_KOL_VITKOV' => $arPost['kol_vitkov_yagozi_pbb'],  
        );
        $arSelect = array('ID', 'IBLOCK_ID', 'NAME');   
        $res = CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);
        
        while ($arEl = $res->GetNext())
        {
            $arEl['COUNT'] = 1;
            $returnRes['antivand_krepeg']['ELEM'][] = $arEl;
        }
        if(count($returnRes['antivand_krepeg']['ELEM']) == 0){
            $returnRes['antivand_krepeg']['ERROR'][] = 'Àíòèâàíäàëüíûé êğåï¸æ íå íàéäåí';
        }   
    }

//p($returnRes);  
        // ïîëó÷èì öåíû äëÿ âñåõ òîâàğîâ
        
    foreach($returnRes as $key => $arElements)
    {
        $arElementNew = array();
        foreach($arElements['ELEM'] as $element)
        {
            if($arPost['color']  == 'öèíê') // íåò ÒÏ (êàê âûÿñíèëîñü îíî ìîæåò áûòü îêàçûâàåòñÿ)
            {
                $resPrice = CPrice::GetList(array(),array('PRODUCT_ID' => $element['ID'],'CATALOG_GROUP_ID' => 1));
                if ($arPrice = $resPrice->Fetch())
                {
                    $element['PRICE'] = CurrencyFormat($arPrice["PRICE"], $arPrice["CURRENCY"]);
                    $element['PRICE_VALUE'] = $arPrice["PRICE"];
                    $element['CURRENCY'] = $arPrice["CURRENCY"];
                }
                else{ // ïîëó÷èì ïåğâîå ÒÏ
                    //$isTP = false;
                    $arOffers = CCatalogSKU::getOffersList( $element['ID'], $element['IBLOCK_ID'], array(), array('ID', 'IBLOCK_ID', 'NAME'), array());
                    foreach ($arOffers[$element['ID']] as $offer)
                    {
                        $element['ID'] = $offer['ID'];
                        //$isTP = true;
                        break;
                    }
                }
            }
            else{ // ïîëó÷èì ÒÏ
                $arOffers = CCatalogSKU::getOffersList( $element['ID'], $element['IBLOCK_ID'], array('%NAME' => $colorValue), array('ID', 'IBLOCK_ID', 'NAME'), array());
                foreach ($arOffers[$element['ID']] as $offer)
                {
                    $element['NAME'] = $offer['NAME'];
                    $element['ID'] = $offer['ID'];
                }
            }
            
            $resPrice = CPrice::GetList(array(),array('PRODUCT_ID' => $element['ID'],'CATALOG_GROUP_ID' => 1));
            if ($arPrice = $resPrice->Fetch())
            {
                $element['PRICE'] = CurrencyFormat($arPrice["PRICE"], $arPrice["CURRENCY"]);
                $element['PRICE_VALUE'] = $arPrice["PRICE"];
                $element['CURRENCY'] = $arPrice["CURRENCY"];
            }
            else
            {
                $returnRes[$key]['ERROR'][] = 'Öåíà äëÿ '.$element['NAME'].' öâåòà '.$colorValue.' íå íàéäåíà!';
            }
            
            $arElementNew[] = $element;
            
           
        }
        $returnRes[$key]['ELEM'] = $arElementNew;
    }
    
//die();
//p($returnRes); 
    $obCache->EndDataCache($returnRes);	

} 

foreach($returnRes as $key => $arElements)
{
    foreach($arElements['ERROR'] as $text)
    {
        echo $text.'<br>';
    }
}

$i=1;
$strElRes = '';
$countPanelForKozirek = 0;
?>
<div class="order-elemennts hidden">
    <?
    $countKKK_KKP = 0;
    foreach($returnRes as $key => $arElements)
    {
        foreach($arElements['ELEM'] as $arValue){
            
            if($key == 'PANELI'){
                $countPanelForKozirek += $arValue['COUNT'];
echo 'êîëè÷åñòâî ïàíåëåé: '.  $countPanelForKozirek.'<br>';
            } 
            elseif($key == 'NABOR_KKP'){
                $arValue['COUNT'] = ceil($arValue['COUNT'] / 12);
                $countKKK_KKP += $arValue['COUNT'] *12;
echo '÷èñëî êğåïåæåé KKP: '. ($arValue['COUNT'] *12).'<br>';
            } 
            elseif($key == 'NABOR_KKK'){
                $arValue['COUNT'] = ceil($arValue['COUNT'] / $arValue['COUNT_IN_NABOR']);
                $countKKK_KKP += $arValue['COUNT'] * $arValue['COUNT_IN_NABOR'];
echo '÷èñëî êğåïåæåé ÊÊÊ: '. ($arValue['COUNT'] * $arValue['COUNT_IN_NABOR']).'<br>';
            }
            elseif($key == 'kozirek'){ // çäåñü ó÷èòûâàåì ÷òî êîçûğ¸ê â êîíöå ìàññèâà
                if( $arPost['type_ob'] == 'sport' || $arPost['type_ob'] == 'sport-other'){
                    $arValue['COUNT'] = ($countPanelForKozirek/2);
                    if($returnRes['kozirek'] && is_array($returnRes['kozirek']['ELEM'])){
                        $returnRes['kozirek']['ELEM'][0]['COUNT'] = $arValue['COUNT'];
                    }
                }
echo 'êîëè÷åñòâî êîçûğüêîâ: '. ($countPanelForKozirek/2).'<br>'; 
p($countPanelForKozirek/2, 'êîëè÷åñòâî êîçûğüêîâ');
            }
            elseif($key == 'antivand_krepeg'){ // çäåñü ó÷èòûâàåì ÷òî àíòèâàíäàëüíûé êğåïåæ â êîíöå ìàññèâà
                $arValue['COUNT'] = ($countKKK_KKP*2);
echo '÷èñëî êğåïåæåé 1: '. ($countKKK_KKP).'<br>';
echo '÷èñëî êğåïåæåé 2: '. ($countKKK_KKP*2).'<br>';
                if($returnRes['antivand_krepeg'] && is_array($returnRes['antivand_krepeg']['ELEM'])){
                    $returnRes['antivand_krepeg']['ELEM'][0]['COUNT'] = $countKKK_KKP*2;
                }
            }
            

            $strElRes .= $arValue['ID'].':'.$arValue['COUNT'].';';  
            ?>
            
        <?}
       
    }
    
    ?> 
    <input type="hidden" name="elements" id="elements" value="<?=$strElRes?>">
</div>
<?
////
//if(!$_POST['order_submit'])
//{
?>
<table class="result">
    <tr>
        <th>¹</th>
        <th>Íàèìåíîâàíèå</th>
        <th>Õàğàêòåğèñòèêè</th>
        <th>Êîë-âî</th>
        <th>Öåíà</th>
        <th>Ñòîèìîñòü</th>
    </tr>
    
    <?
    $totalSumm = 0;
    foreach($returnRes as $key => $arElements)
    {
        foreach($arElements['ELEM'] as $arValue){
            
            if($key == 'NABOR_KKP'){
                $arValue['COUNT'] = ceil($arValue['COUNT'] / 12);
            } 
            elseif($key == 'NABOR_KKK'){
                $arValue['COUNT'] = ceil($arValue['COUNT'] / $arValue['COUNT_IN_NABOR']);
            }
              
            $summ = $arValue['PRICE_VALUE']*$arValue['COUNT'];
            $totalSumm += $summ;
            ?>
            <tr>
                <td class="num"><?=$i++?></td>
                <td class="input-name">
                    <?echo $arValue['NAME'].'<br>';?>
                </td>
                <td class="props"></td>
                <td class="kol"><?=$arValue['COUNT']?></td>
                <td class="price"><?=$arValue['PRICE']?></td>
                <td class="summ"><?=CurrencyFormat($summ, $arValue["CURRENCY"])?></td>
            </tr>
        <?}
    }
    
    ?>
    <tr>
        <td class="summ-total" colspan="6">
            <b>Èòîãî: <?=CurrencyFormat($totalSumm, $arValue["CURRENCY"])?></b>
        </td>
    </tr>
    
    <?
    /*
    if(count($returnRes['PANELI']['ELEM']) > 0){
        foreach($returnRes['PANELI']['ELEM'] as $arValue){?>
            <tr>
                <td class="num"><?=$i++?></td>
                <td class="input-name">
                    <?echo $arValue['NAME'].'<br>';?>
                </td>
                <td class="props"></td>
                <td class="kol"><?=$arValue['COUNT']//$countPanels*$koefColPaneli?></td>
                <td class="price"><?=$arValue['PRICE']?></td>
                <td class="summ"></td>
            </tr>
        <?}
    }else{?>
        <tr>
            <td cols="6">
                <?echo $arValue['NAME'].'<br>';?>
            </td>   
        </tr>   
    <?}?>
    <?//foreach($returnRes['PANELI']['ERROR'] as $text){
       // echo $text.'<br>';
    }//?>
    
    
        <?
        if(count($returnRes['PANELI_KKP']['ELEM']) > 0){ //Íàáîğ êîìïëåêòîâ êğåïåæà ïğÿìîãî ÊÊÏ.
            foreach($returnRes['PANELI_KKP']['ELEM'] as $arValue){?>
                <tr>
                    <td class="num"><?=$i++?></td>
                    <td class="input-name">
                        <?echo $arValue['NAME'].'<br>';?>
                    </td>
                    <td class="props"></td>
                    <td class="kol"><?=$arValue['COUNT']?></td>
                    <td class="price"></td>
                    <td class="summ"></td>
                </tr>
            <?}
         }else{
            //echo $returnRes['PANELI_KKP']['ERROR'];    
        }?>
    <?if($arPost['kreplenie'] == 'homut'){ // õîìóò?>    
        <?
        if(count($returnRes['PANELI_KKK']['ELEM']) > 0){ //Íàáîğ êîìïëåêòîâ êğåïåæà êîíöåâîãî äëÿ ïàíåëè
            foreach($returnRes['PANELI_KKK']['ELEM'] as $arValue){?>
                <tr>
                    <td class="num"><?=$i++?></td>
                    <td class="input-name">
                        <?echo $arValue['NAME'].'<br>';?>
                    </td>
                    <td class="props"></td>
                    <td class="kol"><?=$arValue['COUNT']?></td>
                    <td class="price"></td>
                    <td class="summ"></td>
                </tr>
            <?}
         }else{
            //echo $returnRes['PANELI_KKK']['ERROR'];    
        }?>

    <?}?>
    
    
   
<?
    if(count($returnRes['STOLBI_FOR_PANELI']['ELEM']) > 0){ //Íàáîğ êîìïëåêòîâ êğåïåæà êîíöåâîãî äëÿ ïàíåëè
        foreach($returnRes['STOLBI_FOR_PANELI']['ELEM'] as $arValue){?>
            <tr>
                <td class="num"><?=$i++?></td>
                <td class="input-name">
                    <?echo $arValue['NAME'].'<br>';?>
                </td>
                <td class="props"></td>
                <td class="kol"><?=$arValue['COUNT']?></td>
                <td class="price"></td>
                <td class="summ"></td>
            </tr>
        <?}
     }
     
    // foreach($returnRes['STOLBI_FOR_PANELI']['ERROR'] as $text){
        // echo $text.'<br>';
    // }?>

    
    <?if($arPost['vorota'] == 'on'){?>
        <tr>
            <td class="num"><?=$i++?></td>
            <td class="input-name">
                <?
                if(count($returnRes['VOROTA']['ELEM']) > 0){
                    foreach($returnRes['VOROTA']['ELEM'] as $arValue){
                        echo $arValue['NAME'].'<br>';
                    }
                }else{
                   // echo $returnRes['VOROTA']['ERROR'];    
                }?>
            </td>
            <td class="props"></td>
            <td class="kol"><?=$arPost['kol_vorot']?></td>
            <td class="price"></td>
            <td class="summ"></td>
        </tr>
        
        <tr>
            <td class="num"><?=$i++?></td>
            <td class="input-name">
                <?
                //Õîìóòû êîíöåâûå íà âîğîòà
                if(count($returnRes['VOROTA_KKK']['ELEM']) > 0){
                    foreach($returnRes['VOROTA_KKK']['ELEM'] as $arValue){
                        echo $arValue['NAME'].' (õîìóòû êîíöåâûå íà âîğîòà)<br>';
                    }
                }else{
                   // echo $returnRes['VOROTA_KKK']['ERROR'];    
                }?>
            </td>
            <td class="props"></td>
            <td class="kol"><?=$countKrepegKKKNaborVorota?></td>
            <td class="price"></td>
            <td class="summ"></td>
        </tr>
    <?}?>
    
    <?if($arPost['kalitka'] == 'on'){?>
        <tr>
            <td class="num"><?=$i++?></td>
            <td class="input-name">
                <?
                if(count($returnRes['KALITKA']['ELEM']) > 0){
                    foreach($returnRes['KALITKA']['ELEM'] as $arValue){
                        echo $arValue['NAME'].'<br>';
                    }
                }else{
                   // echo $returnRes['KALITKA']['ERROR'];    
                }?>
            </td>
            <td class="props"></td>
            <td class="kol"><?=$arPost['kol_kalitka']?></td>
            <td class="price"></td>
            <td class="summ"></td>
        </tr>
        
        <tr>
            <td class="num"><?=$i++?></td>
            <td class="input-name">
                <?
                if(count($returnRes['KALITKA_KKK']['ELEM']) > 0){
                    foreach($returnRes['KALITKA_KKK']['ELEM'] as $arValue){
                        echo $arValue['NAME'].' (õîìóòû êîíöåâûå íà êàëèòêó)<br>';
                    }
                }else{
                    //echo $returnRes['KALITKA_KKK']['ERROR'];    
                }?>
            </td>
            <td class="props"></td>
            <td class="kol"><?=$countKrepegKKKNaborKalitka?></td>
            <td class="price"></td>
            <td class="summ"></td>
        </tr>
    <?}?>
    <? // øòàíãè
    if(count($returnRes['STANGI']['ELEM']) > 0){ //øòàíãè
        foreach($returnRes['STANGI']['ELEM'] as $arValue){?>
            <tr>
                <td class="num"><?=$i++?></td>
                <td class="input-name">
                    <?echo $arValue['NAME'].'<br>';?>
                </td>
                <td class="props"></td>
                <td class="kol"><?=$arValue['COUNT']?></td>
                <td class="price"><?=$arValue['PRICE']?></td>
                <td class="summ"><?=$arValue['PRICE_VALUE']*$arValue['COUNT']?></td>
            </tr>
        <?}
     }
     
    foreach($returnRes['STANGI']['ERROR'] as $text){
        echo $text.'<br>';
    }
    */
    ?>
    

</table>
<?
//p($returnRes);
//sort($returnRes['PANELI']['VID_DIAMETR']);
// }
// else{ //ñîçäà¸ì çàêàç
    // p($_POST,'_POST');
// }

?>